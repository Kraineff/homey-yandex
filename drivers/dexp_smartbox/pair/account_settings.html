<div id="view-wrapper"></div>

<script type="text/javascript">
    const wrapper = document.getElementById("view-wrapper");
    let loginInterval;
    
    Homey.setTitle("Аккаунт");
    Homey.emit("account_settings").then(state => {
        if (state) return;

        const auth = document.createElement("button");
        auth.className = "homey-button-primary-shadow-full";
        auth.innerText = "Авторизоваться"
        auth.onclick = () => {
            Homey.emit("account_login").then(url => {
                Homey.popup(url);

                clearInterval(loginInterval);
                loginInterval = setInterval(() => {
                    Homey.emit("account_confirm").then(() => {
                        clearInterval(loginInterval);
                        auth.remove();
                    }).catch(() => {});
                }, 2000);
            });
        };
        
        wrapper.appendChild(auth);
    });
</script>